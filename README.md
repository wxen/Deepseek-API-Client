# Deepseek-API-Client

一个适用于 macOS 的极简 Deepseek 官方 API 调用客户端，提供 GUI 和 CLI 两种使用方式，支持会话管理、历史对话记录编辑、API 参数配置等功能。

## 项目定位

- **极简设计**：专注于核心功能，避免不必要的复杂性
- **双模式支持**：同时提供 GUI（图形界面）和 CLI（命令行）两种使用方式
- **会话管理**：支持创建、切换、删除会话
- **历史记录编辑**：支持查看、编辑、删除历史对话记录
- **API 参数配置**：支持调整 API 调用参数（如温度、最大 tokens 等）
- **跨平台兼容**：基于 Python 开发，理论上支持所有 Python 可运行的平台（主要针对 macOS 优化）

## 项目结构

```
Deepseek API Client/
├── src/                  # 源代码目录
│   ├── cli_main.py       # CLI 版本主文件（Python）
│   ├── gui_main.py       # GUI 版本主文件（Python）
├── Makefile              # 编译配置文件
├── README.md             # 项目说明文档
├── LICENSE               # 许可证文件
└── requirements.txt      # 依赖项文件
```

## 功能特性

### 1. 会话管理
- 创建新会话
- 切换会话
- 删除会话（默认会话不可删除）
- 查看所有会话

### 2. 聊天功能
- 发送消息
- 查看聊天历史
- 编辑历史消息
- 删除历史消息
- 支持多行输入

### 3. 配置管理
- 修改 API 密钥
- 调整模型参数（温度、最大 tokens、top_p 等）
- 查看当前配置

### 4. 双模式支持
- **GUI 模式**：图形界面，操作直观
- **CLI 模式**：命令行界面，轻量高效

## 安装与使用

### 前置要求

- Python 3.7+
- pip（Python 包管理器）

### 依赖项安装

```bash
# 安装所需依赖
pip3 install requests
```

### 运行方式

#### GUI 模式

```bash
# 直接运行 Python 脚本
python3 src/gui_main.py

# 或编译后运行（如果已编译）
./deepseek-api-gui
```

#### CLI 模式

```bash
# 直接运行 Python 脚本
python3 src/cli_main.py

# 或编译后运行（如果已编译）
./deepseek-api
```

## 使用方法详解

### CLI 模式使用

#### 主菜单

启动后会看到主菜单：

```
===== DeepSeek API 客户端 =====
1. 会话管理
2. 聊天
3. 配置管理
4. 退出
```

#### 1. 会话管理

选择 `1` 进入会话管理菜单：

- **列出所有会话**：查看当前所有会话
- **创建新会话**：输入会话名称创建新会话
- **删除会话**：删除指定会话（默认会话不可删除）
- **切换会话**：切换到指定会话

#### 2. 聊天功能

选择 `2` 进入聊天菜单：

- **查看聊天历史**：查看当前会话的聊天记录
- **发送消息**：输入消息内容，按空行结束发送
- **编辑消息**：修改历史消息内容
- **删除消息**：删除历史消息

#### 3. 配置管理

选择 `3` 进入配置管理菜单：

- **查看当前配置**：查看 API 密钥和模型参数
- **编辑配置**：修改 API 密钥、模型名称、温度等参数

### GUI 模式使用

#### 1. 左侧会话管理

- **会话列表**：显示所有会话，当前会话会标记为 "[当前]"
- **新建按钮**：创建新会话
- **删除按钮**：删除选中的会话

#### 2. 右侧聊天面板

- **聊天历史**：显示当前会话的聊天记录
- **消息输入框**：输入消息内容，按 Ctrl+Enter 发送
- **操作提示**：使用方向键选择消息，按空格键编辑

#### 3. 配置标签页

- **API Key**：输入 Deepseek API 密钥
- **模型**：输入模型名称（默认：deepseek-chat）
- **参数调整**：调整温度、最大 Tokens 等参数
- **保存配置**：保存修改的配置

## API 调用说明

### API 端点

本项目使用 Deepseek 官方 API 端点：

```
https://api.deepseek.com/v1/chat/completions
```

### API 调用方法

项目使用标准的 HTTP POST 请求调用 API，具体实现如下：

1. **构建请求体**：
   - 包含系统消息
   - 包含对话历史
   - 包含模型参数（温度、最大 tokens 等）

2. **设置请求头**：
   - Content-Type: application/json
   - Authorization: Bearer {API_KEY}

3. **发送请求**：
   - 使用 requests 库发送 POST 请求
   - 设置 30 秒超时

4. **处理响应**：
   - 解析 JSON 响应
   - 提取助手回复
   - 处理错误情况

### 注意事项

- **API 密钥安全**：请妥善保管您的 API 密钥，不要在公共场合分享
- **API 调用限制**：Deepseek API 可能有调用频率限制，请合理使用
- **网络连接**：确保您的网络连接正常，能够访问 Deepseek API 端点
- **参数调整**：根据您的需求调整模型参数，以获得最佳效果

### API 不适用时的处理

如果 API 调用失败，项目会：

1. 显示详细的错误信息
2. 将错误信息保存到当前会话的历史记录中
3. 允许您重新尝试或修改配置

常见错误类型：

- **认证错误**：API 密钥无效或已过期
- **网络错误**：无法连接到 API 端点
- **参数错误**：请求参数无效
- **速率限制**：超过 API 调用频率限制

## 配置文件

项目使用 `config.json` 文件存储配置信息，格式如下：

```json
{
  "api_key": "YOUR_API_KEY_HERE",
  "model": "deepseek-chat",
  "temperature": 0.7,
  "max_tokens": 2048,
  "top_p": 0.95,
  "frequency_penalty": 0,
  "presence_penalty": 0
}
```

**首次运行时**，项目会自动创建默认配置文件，请在使用前修改 `api_key` 为您的 Deepseek API 密钥。

## 会话存储

项目使用 `sessions.json` 文件存储会话信息，格式如下：

```json
{
  "默认会话": [
    {
      "role": "user",
      "content": "你好",
      "timestamp": "2026-02-22 18:00:00"
    },
    {
      "role": "assistant",
      "content": "你好！很高兴见到你！",
      "timestamp": "2026-02-22 18:00:01"
    }
  ],
  "新会话": []
}
```

## 开发与扩展

### 代码结构

- **cli_main.py**：CLI 版本的主文件，包含命令行界面和逻辑
- **gui_main.py**：GUI 版本的主文件，包含图形界面和逻辑

### 核心类

- **DeepSeekCLIClient**（cli_main.py）：CLI 版本的核心类
- **DeepSeekClient**（gui_main.py）：GUI 版本的核心类

### 核心方法

- **send_to_api**：发送消息到 API 并处理响应
- **save_config**：保存配置到文件
- **load_config**：从文件加载配置
- **save_sessions**：保存会话到文件
- **load_sessions**：从文件加载会话

### 扩展建议

1. **添加更多模型支持**：可以扩展代码以支持其他模型
2. **添加代理支持**：可以添加 HTTP 代理设置
3. **添加消息导出功能**：可以添加导出聊天记录的功能
4. **添加多语言支持**：可以添加多语言界面

## 故障排除

### 常见问题

1. **API 调用失败**
   - 检查 API 密钥是否正确
   - 检查网络连接是否正常
   - 检查 API 端点是否可访问

2. **会话管理失败**
   - 检查 `sessions.json` 文件权限
   - 检查文件格式是否正确

3. **配置不生效**
   - 检查 `config.json` 文件权限
   - 检查文件格式是否正确
   - 确保点击了"保存配置"按钮（GUI 模式）

4. **GUI 界面无法启动**
   - 检查 Python 是否安装
   - 检查 Tkinter 是否可用
   - 检查依赖项是否安装

### 调试建议

- **启用详细日志**：可以在代码中添加更多打印语句
- **检查文件权限**：确保程序有读写配置和会话文件的权限
- **检查网络连接**：使用 curl 或浏览器测试 API 端点

## 许可证

本项目采用 MIT 许可证，详见 LICENSE 文件。

## 贡献

欢迎提交 Issue 和 Pull Request 来改进这个项目！

## 更新日志

### v1.0.0
- 初始版本
- 支持 GUI 和 CLI 两种模式
- 支持会话管理
- 支持历史记录编辑
- 支持 API 参数配置

## 联系信息

如果您有任何问题或建议，请通过以下方式联系：

- GitHub Issues：在项目仓库中提交 Issue
- Email：[im-so-shy@sorry.com]

---

**注意**：本项目仅供学习和研究使用，请遵守 Deepseek API 的使用条款和相关法律法规。
